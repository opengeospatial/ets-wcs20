<?xml version="1.0" encoding="UTF-8"?>
<ctl:package xmlns:ctl="http://www.occamlab.com/ctl" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ows="http://www.opengis.net/ows/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:wcs="http://www.opengis.net/wcs/2.0" xmlns:ctlp="http://www.occamlab.com/te/parsers" xmlns:wcs2="http://www.opengis.net/wcs/2.0" xmlns:sch="http://purl.oclc.org/dsdl/schematron" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml">
    <ctl:test name="wcs2:get-kvp-main">
        <ctl:param name="url" />
        <ctl:assertion>Test WCS 2.0 get kvp extension.</ctl:assertion>
        <ctl:code>
            <xsl:variable name="Capabilities">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SERVICE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0</ctl:param>
                    <ctl:param name="REQUEST">GetCapabilities</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:variable name="SupportsGML">false</xsl:variable>
            <xsl:for-each select="$Capabilities//*[local-name()='ServiceIdentification']/*[local-name()='Profile']">
                <xsl:if test=". = 'http://www.opengis.net/spec/GMLCOV/1.0/conf/gml'">
                    <xsl:variable name="SupportsGML">true</xsl:variable>
                </xsl:if>
            </xsl:for-each>
            <xsl:choose>
                <xsl:when test="not(empty($Capabilities))">
                    <ctl:call-test name="wcs2:get-kvp-req1">
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <!--req2 TBD-->
                    <ctl:call-test name="wcs2:get-kvp-req2">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req3">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req4">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req5">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req6">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req7">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req8">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                    <ctl:call-test name="wcs2:get-kvp-req9">
                        <ctl:with-param name="url" select="$url" />
                        <ctl:with-param name="Capabilities" select="$Capabilities" />
                    </ctl:call-test>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req1-->
    <ctl:test name="wcs2:get-kvp-req1">
        <ctl:param name="Capabilities" />
        <ctl:assertion>Req1:Send a GetCapabilities request to server under test, verify that the response contains a Profile element with said URI.</ctl:assertion>
        <ctl:code>
            <xsl:if test="not(contains(string-join(($Capabilities//*[local-name()='ServiceIdentification']/*[local-name()='Profile']),' '), 'http://www.opengis.net/spec/WCS_protocol-binding_get-kvp/1.0') )">
                <ctl:message>[FAILURE] Send a GetCapabilities request to server under test, verify that the response contains a Profile element with http://www.opengis.net/spec/WCS_protocol-binding_get-kvp/1.0.</ctl:message>
                <ctl:fail />
            </xsl:if>
        </ctl:code>
    </ctl:test>
    <!--req2-->
    <ctl:test name="wcs2:get-kvp-req2">
        <ctl:param name="Capabilities" />
        <ctl:assertion>Req2:Operation resquests shall URL-encode special characters as defined in RFC 2396.</ctl:assertion>
        <ctl:code>
            <ctl:message>[MESSAGE] Done by TEAMEngine when a kvp request is invoked.</ctl:message>
        </ctl:code>
    </ctl:test>
    <!--req3-->
    <ctl:test name="wcs2:get-kvp-req3">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:param name="SupportsGML" />
        <ctl:assertion>Req3:In the WCS 2.0 get kvp requests, keys shall be case insensitive, values shall be case sensitive.</ctl:assertion>
        <!--send requests to the server under test containing lower, mixed, and upper case keys. Check proper response.-->
        <ctl:code>
            <xsl:variable name="CapabilitiesReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0</ctl:param>
                    <ctl:param name="request">GetCapabilities</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($CapabilitiesReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($CapabilitiesReq3//wcs:Capabilities)">
                        <ctl:message>[FAILURE] Send a getCapabilities request in lower case keys, and the result should contain a wcs:Capabilities.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="CapabilitiesReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SERVICE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0</ctl:param>
                    <ctl:param name="REQUEST">GetCapabilities</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($CapabilitiesReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($CapabilitiesReq3//wcs:Capabilities)">
                        <ctl:message>[FAILURE] Send a getCapabilities request in upper case keys, and the result should contain a wcs:Capabilities.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="CapabilitiesReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SeRViCE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0</ctl:param>
                    <ctl:param name="ReQuEST">GetCapabilities</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($CapabilitiesReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($CapabilitiesReq3//wcs:Capabilities)">
                        <ctl:message>[FAILURE] Send a getCapabilities request in mixed case keys, and the result should contain a wcs:Capabilities.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverageReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">DescribeCoverage</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq3//*[local-name()='CoverageDescriptions'])">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in lower case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverageReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="SERVICE">WCS</ctl:param>
                    <ctl:param name="REQUEST">DescribeCoverage</ctl:param>
                    <ctl:param name="COVERAGEID">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq3//*[local-name()='CoverageDescriptions'])">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in upper case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverageReq3">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SeRvICE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="REqUeSt">DescribeCoverage</ctl:param>
                    <ctl:param name="coVerAgeId">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq3)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq3//*[local-name()='CoverageDescriptions'])">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in mixed case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:choose>
                <xsl:when test="$SupportsGML = 'true'">
                    <xsl:variable name="GetCoverageReq3">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq3)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq3//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a getCoverage request in lower case keys, and the result should not contain an ows:Exception.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <xsl:variable name="GetCoverageReq3">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="SERVICE">WCS</ctl:param>
                            <ctl:param name="REQUEST">GetCoverage</ctl:param>
                            <ctl:param name="COVERAGEID">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq3)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq3//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a getCoverage request in upper case keys, and the result should not contain an ows:Exception.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <xsl:variable name="GetCoverageReq3">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="SeRvICE">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="REqUeSt">GetCoverage</ctl:param>
                            <ctl:param name="coVerAgeId">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq3)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq3//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a getCoverage request in mixed case keys, and the result should not contain an ows:Exception.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>the server does not support the gml coverage.</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
            <!--Send requests to the server under test with different case in values, except for the REQUEST, VERSION, and SERVICE parameters. Check that the server differentiates in its response.-->
            <!-- TODO: Implement this if needed. -->
        </ctl:code>
    </ctl:test>
    <!--req4-->
    <!-- TODO: Content-Type header of response should be checked. -->
    <ctl:test name="wcs2:get-kvp-req4">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:param name="SupportsGML" />
        <ctl:assertion>Req4: Operation responses shall include the Content-Type header field as defined by IETF RFC 2616.</ctl:assertion>
        <ctl:code>
            <xsl:variable name="Capabilities">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="request">GetCapabilities</ctl:param>
                    <ctlp:HTTPParser>
                        <ctlp:parse mime="application/gml+xml">
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctlp:parse>
                    </ctlp:HTTPParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($Capabilities)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($Capabilities//wcs:Capabilities)">
                        <ctl:message>[FAILURE] Send a valid getCapabilities request, and the result should contain a wcs:Capabilities in application/gml+xml.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverage">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">DescribeCoverage</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:HTTPParser>
                        <ctlp:parse mime="application/gml+xml">
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctlp:parse>
                    </ctlp:HTTPParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverage)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverage//wcs:CoverageDescriptions)">
                        <ctl:message>[FAILURE] Send a valid DescribeCoverage request, and the result should contain a wcs:CoverageDescriptions in application/gml+xml.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:choose>
                <xsl:when test="$SupportsGML = 'true'">
                    <xsl:variable name="GetCoverage">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:HTTPParser>
                                <ctlp:parse mime="application/gml+xml">
                                    <ctlp:XMLValidatingParser>
                                        <ctlp:schemas>
                                            <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                        </ctlp:schemas>
                                    </ctlp:XMLValidatingParser>
                                </ctlp:parse>
                            </ctlp:HTTPParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverage)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverage//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a valid GetCoverage request without both format and mediaType parameters, and the result should be in the given default format.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>the server does not support the gml coverage.</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req5-->
    <ctl:test name="wcs2:get-kvp-req5">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:assertion>Req5:The response to a successful GetCapabilities request shall be a valid XML document of type wcs:CapabilitiesType.</ctl:assertion>
        <ctl:code>
            <xsl:variable name="CapabilitiesReq5">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="request">GetCapabilities</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsGetCapabilities.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($CapabilitiesReq5)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($CapabilitiesReq5//wcs:Capabilities)">
                        <ctl:message>[FAILURE] Send a valid getCapabilities request, and the result should contain a wcs:Capabilities according to its schema definition.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req6-->
    <ctl:test name="wcs2:get-kvp-req6">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:assertion>Req6:The KVP encoding of a DescribeCoverage request shall be as defined in the specification.</ctl:assertion>
        <ctl:code>
            <xsl:variable name="DescribeCoverageReq6">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">DescribeCoverage</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq6)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq6//wcs:CoverageDescriptions)">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in lower case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverageReq6">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="SERVICE">WCS</ctl:param>
                    <ctl:param name="REQUEST">DescribeCoverage</ctl:param>
                    <ctl:param name="COVERAGEID">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq6)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq6//wcs:CoverageDescriptions)">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in upper case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <xsl:variable name="DescribeCoverageReq6">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SeRvICE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="REqUeSt">DescribeCoverage</ctl:param>
                    <ctl:param name="coVerAgeId">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq6)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverageReq6//wcs:CoverageDescriptions)">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in mixed case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req7-->
    <ctl:test name="wcs2:get-kvp-req7">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:param name="SupportsGML" />
        <ctl:assertion>Req7:The KVP encoding of a GetCoverage request shall be as defined in the specification.</ctl:assertion>
        <ctl:code>
            <xsl:choose>
                <xsl:when test="$SupportsGML = 'true'">
                    <xsl:variable name="GetCoverageReq7">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq7)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq7//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a GetCoverage request in lower case keys, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <xsl:variable name="GetCoverageReq7">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="SERVICE">WCS</ctl:param>
                            <ctl:param name="REQUEST">GetCoverage</ctl:param>
                            <ctl:param name="COVERAGEID">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq7)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq7//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a GetCoverage request in lower case keys, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <xsl:variable name="GetCoverageReq7">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="SeRvICE">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="REqUeSt">GetCoverage</ctl:param>
                            <ctl:param name="coVerAgeId">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq7)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq7//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a GetCoverage request in lower case keys, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>the server does not support the gml coverage.</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req8-->
    <ctl:test name="wcs2:get-kvp-req8">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:param name="SupportsGML" />
        <ctl:assertion>Req8:getCoverage request subset shall adhere to the EBNF syntax as specified in the specification.</ctl:assertion>
        <ctl:code>
            <xsl:variable name="DescribeCoverage">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">DescribeCoverage</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsDescribeCoverage.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverage)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="empty($DescribeCoverage//wcs:CoverageDescriptions)">
                        <ctl:message>[FAILURE] Send a DescribeCoverage request in lower case keys, and the result should contain a wcs:CoverageDescriptions.</ctl:message>
                        <ctl:fail />
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
            <!--send a valid getCoverage request without a subsetting parameter-->
            <xsl:choose>
                <xsl:when test="$SupportsGML = 'true'">
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] send a valid getCoverage request without a subsetting parameter, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <!--send a valid getCoverage request with one trimming and without a slicing-->
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctl:param name="subset">
                                <xsl:value-of select="tokenize(normalize-space($DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1][@axisLabels]/@axisLabels),' ')[1]" />
                                (
                                <xsl:value-of select="number(tokenize(normalize-space($DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='lowerCorner'][1]),' ')[1])" />
                                ,
                                <xsl:value-of select="number(tokenize(normalize-space($DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope']/*[local-name()='lowerCorner'][1]),' ')[1])" />
                                )
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a valid getCoverage request with one trimming and without a slicing, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <!--send a valid getCoverage request with more trimmings and without a slicing-->
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <xsl:call-template name="for-loop-req8_1">
                                <xsl:with-param name="i">1</xsl:with-param>
                                <xsl:with-param name="count">
                                    <xsl:value-of select="number($DescribeCoverage//*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/@srsDimension)" />
                                </xsl:with-param>
                                <xsl:with-param name="axisLabels" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1][@axisLabels]/@axisLabels" />
                                <xsl:with-param name="low" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='lowerCorner'][1]" />
                                <xsl:with-param name="high" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='upperCorner'][1]" />
                            </xsl:call-template>
                            <xsl:template name="for-loop-req8_1">
                                <xsl:param name="i" as="xs:integer" />
                                <xsl:param name="count" as="xs:integer" />
                                <xsl:param name="axisLabels" />
                                <xsl:param name="low" />
                                <xsl:param name="high" />
                                <xsl:if test="$i &lt;= $count">
                                    <ctl:param name="subset">
                                        <xsl:value-of select="tokenize(normalize-space($axisLabels),' ')[$i]" />
                                        (
                                        <xsl:value-of select="number(tokenize(normalize-space($low),' ')[$i])" />
                                        ,
                                        <xsl:value-of select="number(tokenize(normalize-space($high),' ')[$i])" />
                                        )
                                    </ctl:param>
                                </xsl:if>
                                <xsl:if test="$i &lt;= $count">
                                    <xsl:call-template name="for-loop-req8_1">
                                        <xsl:with-param name="i">
                                            <xsl:value-of select="$i + 1" />
                                        </xsl:with-param>
                                        <xsl:with-param name="count">
                                            <xsl:value-of select="$count" />
                                        </xsl:with-param>
                                        <xsl:with-param name="axisLabels" select="$axisLabels" />
                                        <xsl:with-param name="low" select="$low" />
                                        <xsl:with-param name="high" select="$high" />
                                    </xsl:call-template>
                                </xsl:if>
                            </xsl:template>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a valid getCoverage request with two trimmings and without a slicing, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <!--send a valid getCoverage request with one slicing and without a trimming-->
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <ctl:param name="subset">
                                <xsl:value-of select="tokenize(normalize-space($DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1][@axisLabels]/@axisLabels[1]),' ')[1]" />
                                (
                                <xsl:value-of select="number(tokenize(normalize-space($DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='lowerCorner'][1]),' ')[1])" />
                                )
                            </ctl:param>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] send a valid getCoverage request with one slicing and without a trimming, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <!--send a valid getCoverage request with more slicings and without a trimming-->
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <xsl:call-template name="for-loop-req8_2">
                                <xsl:with-param name="i">1</xsl:with-param>
                                <xsl:with-param name="count">
                                    <xsl:value-of select="number($DescribeCoverage//*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/@srsDimension)" />
                                </xsl:with-param>
                                <xsl:with-param name="axisLabels" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1][@axisLabels]/@axisLabels" />
                                <xsl:with-param name="low" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='lowerCorner'][1]" />
                                <xsl:with-param name="high" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='upperCorner'][1]" />
                            </xsl:call-template>
                            <xsl:template name="for-loop-req8_2">
                                <xsl:param name="i" as="xs:integer" />
                                <xsl:param name="count" as="xs:integer" />
                                <xsl:param name="axisLabels" />
                                <xsl:param name="low" />
                                <xsl:param name="high" />
                                <xsl:if test="$i &lt;= $count">
                                    <ctl:param name="subset">
                                        <xsl:value-of select="tokenize(normalize-space($axisLabels),' ')[$i]" />
                                        (
                                        <xsl:value-of select="number(tokenize(normalize-space($low),' ')[$i])" />
                                        )
                                    </ctl:param>
                                </xsl:if>
                                <xsl:if test="$i &lt;= $count">
                                    <xsl:call-template name="for-loop-req8_2">
                                        <xsl:with-param name="i">
                                            <xsl:value-of select="$i + 1" />
                                        </xsl:with-param>
                                        <xsl:with-param name="count">
                                            <xsl:value-of select="$count" />
                                        </xsl:with-param>
                                        <xsl:with-param name="axisLabels" select="$axisLabels" />
                                        <xsl:with-param name="low" select="$low" />
                                        <xsl:with-param name="high" select="$high" />
                                    </xsl:call-template>
                                </xsl:if>
                            </xsl:template>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a valid getCoverage request with two slicings and without a trimming, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                    <!--send trim operations with trim coordinates and with * for low and high bound-->
                    <xsl:variable name="GetCoverageReq8">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$url" />
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="service">WCS</ctl:param>
                            <ctl:param name="VERSION">2.0.1</ctl:param>
                            <ctl:param name="request">GetCoverage</ctl:param>
                            <ctl:param name="coverageid">
                                <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                            </ctl:param>
                            <xsl:call-template name="for-loop-req8_3">
                                <xsl:with-param name="i">1</xsl:with-param>
                                <xsl:with-param name="count">
                                    <xsl:value-of select="number($DescribeCoverage//*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/@srsDimension)" />
                                </xsl:with-param>
                                <xsl:with-param name="axisLabels" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]//*[local-name()='boundedBy']/*[local-name()='Envelope'][1][@axisLabels]/@axisLabels" />
                                <xsl:with-param name="low" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='lowerCorner'][1]" />
                                <xsl:with-param name="high" select="$DescribeCoverage//*[local-name()='CoverageDescription'][1]/*[local-name()='boundedBy']/*[local-name()='Envelope'][1]/*[local-name()='upperCorner'][1]" />
                            </xsl:call-template>
                            <xsl:template name="for-loop-req8_3">
                                <xsl:param name="i" as="xs:integer" />
                                <xsl:param name="count" as="xs:integer" />
                                <xsl:param name="axisLabels" />
                                <xsl:param name="low" />
                                <xsl:param name="high" />
                                <xsl:if test="$i &lt;= $count">
                                    <ctl:param name="subset">
                                        <xsl:value-of select="tokenize(normalize-space($axisLabels),' ')[$i]" />
                                        (
                                        <xsl:value-of select="number(tokenize(normalize-space($low),' ')[$i])" />
                                        ,*)
                                    </ctl:param>
                                </xsl:if>
                                <xsl:if test="$i &lt;= $count">
                                    <xsl:call-template name="for-loop-req8_3">
                                        <xsl:with-param name="i">
                                            <xsl:value-of select="$i + 1" />
                                        </xsl:with-param>
                                        <xsl:with-param name="count">
                                            <xsl:value-of select="$count" />
                                        </xsl:with-param>
                                        <xsl:with-param name="axisLabels" select="$axisLabels" />
                                        <xsl:with-param name="low" select="$low" />
                                        <xsl:with-param name="high" select="$high" />
                                    </xsl:call-template>
                                </xsl:if>
                            </xsl:template>
                            <ctlp:XMLValidatingParser>
                                <ctlp:schemas>
                                    <ctlp:schema type="resource">wcs/2.0/wcsGetCoverage.xsd</ctlp:schema>
                                </ctlp:schemas>
                            </ctlp:XMLValidatingParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:choose>
                        <xsl:when test="empty($GetCoverageReq8)">
                            <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                            <ctl:fail />
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:if test="not(empty($GetCoverageReq8//*[local-name()='Exception']))">
                                <ctl:message>[FAILURE] Send a valid getCoverage request with two trimmings and without a slicing, and the result should not be an ows:ExceptionReport.</ctl:message>
                                <ctl:fail />
                            </xsl:if>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>the server does not support the gml coverage.</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--req9-->
    <ctl:test name="wcs2:get-kvp-req9">
        <ctl:param name="url" />
        <ctl:param name="Capabilities" />
        <ctl:assertion>Req9:When a WCS server encounters an error described in column "meaning of exception code" in Table 3 then it shall return the corresponding exception report message with the contents of the locator parameter value as specified in the specification. Test passes if exception is reported according to requirement.</ctl:assertion>
        <ctl:code>
            <!--The exception test for Capabilities-->
            <xsl:variable name="CapabilitiesReq9">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="SERVICE">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="REQUEST">GetCapabilities_Bogus</ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsAll.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($CapabilitiesReq9)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:for-each select="$CapabilitiesReq9//ows:Exception">
                        <xsl:choose>
                            <xsl:when test="./@exceptionCode='InvalidEncodingSyntax'">
                                <xsl:if test="empty(//*[local-name()='Exception']/@locator)">
                                    <ctl:message xmlns:ctl="http://www.occamlab.com/ctl">[FAILURE] The violating element is not given</ctl:message>
                                    <ctl:fail />
                                </xsl:if>
                            </xsl:when>
                            <xsl:otherwise />
                        </xsl:choose>
                    </xsl:for-each>
                </xsl:otherwise>
            </xsl:choose>
            <!--The exception test for DescribeCoverage-->
            <xsl:variable name="DescribeCoverageReq9">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">DescribeCoverage_Bogus</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsAll.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($DescribeCoverageReq9)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:for-each select="$DescribeCoverageReq9//ows:Exception">
                        <xsl:choose>
                            <xsl:when test="./@exceptionCode='InvalidEncodingSyntax'">
                                <xsl:if test="empty(//*[local-name()='Exception']/@locator)">
                                    <ctl:message xmlns:ctl="http://www.occamlab.com/ctl">[FAILURE] The violating element is not given</ctl:message>
                                    <ctl:fail />
                                </xsl:if>
                            </xsl:when>
                            <xsl:otherwise />
                        </xsl:choose>
                    </xsl:for-each>
                </xsl:otherwise>
            </xsl:choose>
            <!--The exception test for GetCoverage-->
            <xsl:variable name="GetCoverageReq9">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$url" />
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="service">WCS</ctl:param>
                    <ctl:param name="VERSION">2.0.1</ctl:param>
                    <ctl:param name="request">GetCoverage_Bogus</ctl:param>
                    <ctl:param name="coverageid">
                        <xsl:value-of select="$Capabilities//*[local-name()='CoverageSummary'][1]/*[local-name()='CoverageId'][1]" />
                    </ctl:param>
                    <ctlp:XMLValidatingParser>
                        <ctlp:schemas>
                            <ctlp:schema type="resource">wcs/2.0/wcsAll.xsd</ctlp:schema>
                        </ctlp:schemas>
                    </ctlp:XMLValidatingParser>
                </ctl:request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="empty($GetCoverageReq9)">
                    <ctl:message>[FAILURE] Parsing or validation errors.</ctl:message>
                    <ctl:fail />
                </xsl:when>
                <xsl:otherwise>
                    <xsl:for-each select="$GetCoverageReq9//ows:Exception">
                        <xsl:choose>
                            <xsl:when test="./@exceptionCode='InvalidEncodingSyntax'">
                                <xsl:if test="empty(//*[local-name()='Exception'][@locator]/@locator)">
                                    <ctl:message xmlns:ctl="http://www.occamlab.com/ctl">[FAILURE] The violating element is not given</ctl:message>
                                    <ctl:fail />
                                </xsl:if>
                            </xsl:when>
                            <xsl:otherwise />
                        </xsl:choose>
                    </xsl:for-each>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
</ctl:package>
